<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banca Digital</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .transaction-in { color: #10b981; }
        .transaction-out { color: #ef4444; }
        .transaction-loan { color: #8b5cf6; }
        .transaction-tax { color: #3b82f6; }
        .transaction-payment { color: #6366f1; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="login-screen" class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
            <div class="bg-white py-8 px-4 shadow-xl rounded-2xl sm:px-10">
                <div class="text-center">
                    <div class="bg-indigo-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg data-lucide="file-text" class="h-8 w-8 text-white"></svg>
                    </div>
                    <h2 class="mt-2 text-3xl font-bold text-gray-900">Banca Digital</h2>
                    <p class="mt-2 text-sm text-gray-600">Sistema de gestión financiera avanzada</p>
                </div>

                <form id="login-form" class="mt-8 space-y-6" onsubmit="handleLogin(event)">
                    <div class="rounded-md shadow-sm -space-y-px">
                        <div>
                            <label for="username" class="sr-only">Usuario</label>
                            <input
                                id="username"
                                name="username"
                                type="text"
                                required
                                class="appearance-none rounded-t-lg relative block w-full px-4 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                                placeholder="Usuario (usuario1 o usuario2)"
                            >
                        </div>
                        <div>
                            <label for="password" class="sr-only">Contraseña</label>
                            <input
                                id="password"
                                name="password"
                                type="password"
                                required
                                class="appearance-none rounded-b-lg relative block w-full px-4 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                                placeholder="Contraseña (1234)"
                            >
                        </div>
                    </div>

                    <div>
                        <button
                            type="submit"
                            class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200"
                        >
                            Iniciar Sesión
                        </button>
                    </div>
                    
                    <div class="text-center text-sm text-gray-500">
                        <p>Pruebe con:</p>
                        <p class="font-medium">usuario1 / 1234</p>
                        <p class="font-medium">usuario2 / 1234</p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="dashboard-screen" class="hidden min-h-screen bg-gray-50">
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <div class="bg-indigo-600 w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                        <svg data-lucide="file-text" class="h-5 w-5 text-white"></svg>
                    </div>
                    <h1 class="text-xl font-bold text-gray-900">Banca Digital - <span id="current-user"></span></h1>
                </div>
                <button
                    onclick="handleLogout()"
                    class="flex items-center text-gray-600 hover:text-gray-900 transition-colors"
                >
                    <svg data-lucide="log-out" class="h-5 w-5 mr-1"></svg>
                    Cerrar sesión
                </button>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-xl overflow-hidden">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold text-white">Saldo Disponible</h2>
                            <p id="balance-display" class="mt-4 text-3xl font-bold text-white">$5,000.00</p>
                            <div class="mt-6 grid grid-cols-2 gap-4">
                                <button
                                    onclick="processMonthlyCharges()"
                                    class="w-full bg-white text-indigo-600 hover:bg-indigo-50 font-medium py-2 px-4 rounded-lg transition-colors"
                                >
                                    Procesar Mensual
                                </button>
                                <button
                                    onclick="generateStatement()"
                                    class="w-full bg-indigo-700 text-white hover:bg-indigo-800 font-medium py-2 px-4 rounded-lg transition-colors"
                                >
                                    Estado de Cuenta
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 bg-white rounded-2xl shadow overflow-hidden">
                        <div class="p-6">
                            <div class="flex items-center mb-4">
                                <svg data-lucide="credit-card" class="h-5 w-5 text-indigo-600 mr-2"></svg>
                                <h2 class="text-lg font-semibold text-gray-900">Solicitar Préstamo</h2>
                            </div>
                            <form id="loan-form" onsubmit="applyLoan(event)" class="space-y-4">
                                <div>
                                    <label for="loanAmount" class="block text-sm font-medium text-gray-700">
                                        Monto solicitado
                                    </label>
                                    <div class="mt-1 relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input
                                            type="number"
                                            name="loanAmount"
                                            id="loanAmount"
                                            class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                            placeholder="1000"
                                            min="100"
                                            step="100"
                                            required
                                        >
                                    </div>
                                </div>
                                <button
                                    type="submit"
                                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                >
                                    Solicitar Préstamo
                                </button>
                            </form>
                            
                            <div id="loans-container" class="mt-6 pt-6 border-t border-gray-200 hidden">
                                <h3 class="text-sm font-medium text-gray-900 mb-3">Préstamos Activos</h3>
                                <!-- Loans will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow overflow-hidden">
                        <div class="p-6">
                            <div class="flex items-center mb-4">
                                <svg data-lucide="send" class="h-5 w-5 text-indigo-600 mr-2"></svg>
                                <h2 class="text-lg font-semibold text-gray-900">Realizar Transferencia</h2>
                            </div>
                            <form id="transfer-form" onsubmit="transferFunds(event)" class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="recipient" class="block text-sm font-medium text-gray-700">
                                            Destinatario
                                        </label>
                                        <select
                                            id="recipient"
                                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
                                        >
                                            <option value="usuario1">usuario1</option>
                                            <option value="usuario2">usuario2</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="amount" class="block text-sm font-medium text-gray-700">
                                            Monto
                                        </label>
                                        <div class="mt-1 relative rounded-md shadow-sm">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 sm:text-sm">$</span>
                                            </div>
                                            <input
                                                type="number"
                                                name="amount"
                                                id="transferAmount"
                                                class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                                placeholder="100.00"
                                                min="0.01"
                                                step="0.01"
                                                required
                                            >
                                        </div>
                                    </div>
                                </div>
                                <button
                                    type="submit"
                                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                >
                                    Transferir
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="mt-6 bg-white rounded-2xl shadow overflow-hidden">
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <svg data-lucide="file-text" class="h-5 w-5 text-indigo-600 mr-2"></svg>
                                    <h2 class="text-lg font-semibold text-gray-900">Historial de Transacciones</h2>
                                </div>
                                <span id="transaction-count" class="text-sm text-gray-500">
                                    Últimas 1 transacciones
                                </span>
                            </div>
                            
                            <div class="flow-root">
                                <ul id="transactions-list" class="-my-3 divide-y divide-gray-200">
                                    <!-- Transactions will be inserted here -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Initialize accounts
        const accounts = [
            {
                username: 'usuario1',
                password: '1234',
                balance: 5000.00,
                transactions: [
                    { id: 1, type: 'deposit', amount: 5000.00, date: formatDate(new Date()), description: 'Initial deposit' }
                ],
                loans: []
            },
            {
                username: 'usuario2',
                password: '1234',
                balance: 3000.00,
                transactions: [
                    { id: 2, type: 'deposit', amount: 3000.00, date: formatDate(new Date()), description: 'Initial deposit' }
                ],
                loans: []
            }
        ];
        
        let currentUser = null;

        // Helper functions
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-ES', { 
                style: 'currency', 
                currency: 'USD',
                minimumFractionDigits: 2 
            }).format(amount);
        }

        function updateBalanceDisplay() {
            const balanceDisplay = document.getElementById('balance-display');
            balanceDisplay.textContent = formatCurrency(currentUser.account.balance);
        }

        function renderTransactions() {
            const transactionsList = document.getElementById('transactions-list');
            transactionsList.innerHTML = '';
            
            const transactions = [...currentUser.account.transactions].reverse();
            document.getElementById('transaction-count').textContent = 
                `Últimas ${transactions.length} transacciones`;
            
            transactions.forEach(transaction => {
                const transactionTypeClass = 
                    transaction.type === 'transfer_in' ? 'transaction-in' :
                    transaction.type === 'loan' ? 'transaction-loan' :
                    transaction.type === 'tax' ? 'transaction-tax' :
                    transaction.type === 'loan_payment' ? 'transaction-payment' : 'transaction-out';
                
                const icon = 
                    transaction.type === 'transfer_in' ? '<svg data-lucide="arrow-down-circle" class="h-5 w-5 mr-2"></svg>' :
                    transaction.type === 'transfer_out' ? '<svg data-lucide="arrow-up-circle" class="h-5 w-5 mr-2"></svg>' :
                    transaction.type === 'tax' ? '<svg data-lucide="calculator" class="h-5 w-5 mr-2"></svg>' :
                    '<svg data-lucide="credit-card" class="h-5 w-5 mr-2"></svg>';
                
                const description = 
                    transaction.type === 'transfer_in' ? `Transferencia recibida de ${transaction.sender}` :
                    transaction.type === 'transfer_out' ? `Transferencia a ${transaction.recipient}` :
                    transaction.type === 'tax' ? 'Pago de impuestos' :
                    transaction.type === 'loan' ? 'Préstamo aprobado' :
                    transaction.type === 'loan_payment' ? 'Abono a préstamo' :
                    transaction.description;
                
                const amountDisplay = 
                    transaction.type === 'transfer_in' ? `+${formatCurrency(Math.abs(transaction.amount))}` :
                    formatCurrency(Math.abs(transaction.amount));
                
                const transactionElement = document.createElement('li');
                transactionElement.className = 'py-3';
                transactionElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            ${icon}
                            <div>
                                <p class="text-sm font-medium text-gray-900">${description}</p>
                                <p class="text-xs text-gray-500">${transaction.date}</p>
                            </div>
                        </div>
                        <span class="text-sm font-semibold ${transactionTypeClass}">
                            ${amountDisplay}
                        </span>
                    </div>
                `;
                transactionsList.appendChild(transactionElement);
            });
            
            lucide.createIcons();
        }

        function renderLoans() {
            const loansContainer = document.getElementById('loans-container');
            const loansList = currentUser.account.loans;
            
            if (loansList.length === 0) {
                loansContainer.classList.add('hidden');
                return;
            }
            
            loansContainer.classList.remove('hidden');
            const loansContent = document.createElement('div');
            loansContent.innerHTML = '';
            
            loansList.forEach(loan => {
                const progress = ((loan.amount - loan.remaining) / loan.amount) * 100;
                loansContent.innerHTML += `
                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="font-medium">${formatCurrency(loan.amount)}</span>
                            <span class="text-gray-500">${progress.toFixed(0)}% pagado</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div 
                                class="bg-indigo-600 h-2 rounded-full" 
                                style="width: ${progress}%"
                            ></div>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                            Cuota mensual: ${formatCurrency(loan.monthlyPayment)}
                        </p>
                    </div>
                `;
            });
            
            const loansContainerContent = document.getElementById('loans-container');
            loansContainerContent.querySelector('h3').nextElementSibling.innerHTML = loansContent.innerHTML;
        }

        // Core functionality
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = accounts.find(u => 
                u.username === username && u.password === password
            );
            
            if (user) {
                currentUser = { ...user, account: { ...user } };
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('dashboard-screen').classList.remove('hidden');
                document.getElementById('current-user').textContent = currentUser.username;
                updateBalanceDisplay();
                renderTransactions();
                renderLoans();
            } else {
                alert('Credenciales inválidas. Intente usuario1/1234 o usuario2/1234');
            }
        }

        function handleLogout() {
            currentUser = null;
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('dashboard-screen').classList.add('hidden');
        }

        function transferFunds(event) {
            event.preventDefault();
            const amount = parseFloat(document.getElementById('transferAmount').value);
            const recipientUsername = document.getElementById('recipient').value;
            
            if (isNaN(amount) || amount <= 0) {
                alert('Monto inválido');
                return;
            }
            
            const recipient = accounts.find(a => a.username === recipientUsername);
            if (!recipient) {
                alert('Destinatario no encontrado');
                return;
            }
            
            if (currentUser.account.balance < amount) {
                alert('Fondos insuficientes');
                return;
            }
            
            // Update sender
            const newSenderBalance = currentUser.account.balance - amount;
            const newSenderTransactions = [
                ...currentUser.account.transactions,
                {
                    id: Date.now(),
                    type: 'transfer_out',
                    amount,
                    date: formatDate(new Date()),
                    recipient: recipientUsername
                }
            ];
            
            // Update recipient
            const newRecipientBalance = recipient.balance + amount;
            const newRecipientTransactions = [
                ...recipient.transactions,
                {
                    id: Date.now() + 1,
                    type: 'transfer_in',
                    amount,
                    date: formatDate(new Date()),
                    sender: currentUser.username
                }
            ];
            
            // Update accounts
            accounts.forEach(account => {
                if (account.username === currentUser.username) {
                    account.balance = newSenderBalance;
                    account.transactions = newSenderTransactions;
                }
                if (account.username === recipientUsername) {
                    account.balance = newRecipientBalance;
                    account.transactions = newRecipientTransactions;
                }
            });
            
            // Update current user
            currentUser.account.balance = newSenderBalance;
            currentUser.account.transactions = newSenderTransactions;
            
            // Reset form
            document.getElementById('transferAmount').value = '';
            
            // Update UI
            updateBalanceDisplay();
            renderTransactions();
            alert(`Transferencia de ${formatCurrency(amount)} realizada con éxito`);
        }

        function applyLoan(event) {
            event.preventDefault();
            const amount = parseFloat(document.getElementById('loanAmount').value);
            
            if (isNaN(amount) || amount <= 0) {
                alert('Monto de préstamo inválido');
                return;
            }
            
            const newLoan = {
                id: Date.now(),
                amount,
                monthlyPayment: amount * 0.05,
                remaining: amount,
                startDate: formatDate(new Date())
            };
            
            // Update user account
            const newBalance = currentUser.account.balance + amount;
            const newTransactions = [
                ...currentUser.account.transactions,
                {
                    id: Date.now() + 2,
                    type: 'loan',
                    amount,
                    date: formatDate(new Date()),
                    description: `Préstamo aprobado - Cuota mensual: ${formatCurrency(amount * 0.05)}`
                }
            ];
            
            // Update accounts
            accounts.forEach(account => {
                if (account.username === currentUser.username) {
                    account.balance = newBalance;
                    account.transactions = newTransactions;
                    account.loans = [...account.loans, newLoan];
                }
            });
            
            // Update current user
            currentUser.account.balance = newBalance;
            currentUser.account.transactions = newTransactions;
            currentUser.account.loans = [...currentUser.account.loans, newLoan];
            
            // Reset form
            document.getElementById('loanAmount').value = '';
            
            // Update UI
            updateBalanceDisplay();
            renderTransactions();
            renderLoans();
            alert(`Préstamo de ${formatCurrency(amount)} aprobado con éxito`);
        }

        function processMonthlyCharges() {
            const taxRate = 0.08; // 8% de impuestos
            
            // Calculate tax
            const taxAmount = currentUser.account.balance * taxRate;
            const newBalanceAfterTax = currentUser.account.balance - taxAmount;
            
            // Process loans
            let balanceAfterLoans = newBalanceAfterTax;
            const updatedLoans = [...currentUser.account.loans];
            const newTransactions = [...currentUser.account.transactions];
            
            updatedLoans.forEach((loan, index) => {
                const payment = Math.min(loan.monthlyPayment, loan.remaining);
                balanceAfterLoans -= payment;
                updatedLoans[index].remaining -= payment;
                
                if (payment > 0) {
                    newTransactions.push({
                        id: Date.now() + loan.id,
                        type: 'loan_payment',
                        amount: payment,
                        date: formatDate(new Date()),
                        description: `Abono a préstamo #${loan.id}`
                    });
                }
            });
            
            // Update accounts
            accounts.forEach(account => {
                if (account.username === currentUser.username) {
                    account.balance = balanceAfterLoans;
                    account.transactions = [
                        ...account.transactions,
                        {
                            id: Date.now(),
                            type: 'tax',
                            amount: taxAmount,
                            date: formatDate(new Date()),
                            description: `Impuestos mensuales (${(taxRate * 100).toFixed(0)}%)`
                        }
                    ];
                    account.loans = updatedLoans.filter(loan => loan.remaining > 0);
                }
            });
            
            // Update current user
            currentUser.account.balance = balanceAfterLoans;
            currentUser.account.transactions = [
                ...currentUser.account.transactions,
                {
                    id: Date.now(),
                    type: 'tax',
                    amount: taxAmount,
                    date: formatDate(new Date()),
                    description: `Impuestos mensuales (${(taxRate * 100).toFixed(0)}%)`
                }
            ];
            currentUser.account.loans = updatedLoans.filter(loan => loan.remaining > 0);
            
            // Update UI
            updateBalanceDisplay();
            renderTransactions();
            renderLoans();
            alert('Procesamiento mensual completado: Impuestos y pagos de préstamos aplicados');
        }

        function generateStatement() {
            // Show only last 10 transactions
            accounts.forEach(account => {
                if (account.username === currentUser.username) {
                    account.transactions = account.transactions.slice(-10);
                }
            });
            
            currentUser.account.transactions = currentUser.account.transactions.slice(-10);
            renderTransactions();
            alert('Estado de cuenta generado con las últimas 10 transacciones');
        }

        // Initialize icons after DOM loads
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
</body>
</html>